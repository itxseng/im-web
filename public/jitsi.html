<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Jitsi Meeting</title>
  <style>
    html,body,#jitsi-container{
      width:100%;
      height:100%;
      margin:0;
      padding:0;
      overflow:hidden;
    }
    #closeBtn{
      position:absolute;
      top:10px;
      right:10px;
      z-index:1000;
      width:32px;
      height:32px;
      line-height:32px;
      text-align:center;
      border-radius:16px;
      background:rgba(0,0,0,0.5);
      color:#fff;
      cursor:pointer;
      font-size:18px;
    }
  </style>
</head>
<body>
  <div id="jitsi-container"></div>
  <div id="closeBtn">&#10005;</div>
  <script src="https://meet.jit.si/external_api.js"></script>
  <script>
    (function(){
      const params=new URLSearchParams(location.search);
      const url=params.get('url');
      const container=document.getElementById('jitsi-container');
      let api=null;
      if(url){
        const a=document.createElement('a');
        a.href=url;
        const domain=a.host;
        let room=a.pathname.replace(/^\//,'');
        const search=new URLSearchParams(a.search);
        const options={roomName:room,parentNode:container};
        if(search.get('jwt')) options.jwt=search.get('jwt');
        api=new JitsiMeetExternalAPI(domain,options);
        api.addListener('readyToClose',()=>{window.close();});
      }else{
        container.innerHTML='Invalid meeting url';
      }
      document.getElementById('closeBtn').onclick=function(){
        if(api){api.executeCommand('hangup');}
        window.close();
      };
      window.addEventListener('beforeunload',()=>{if(api) api.dispose();});
    })();
  </script>
</body>
</html>
